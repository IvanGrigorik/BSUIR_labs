<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//RU">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<META HTTP-EQUIV="Content-Language" CONTENT="ru">

<title>Лекция</title>
<style type="text/css">
 body {font-family: Arial, sans-serif;}
 .c {font-family: "Courier New", Courier, monospace}
</style>

</HEAD><BODY>

<div align="justify">

<p>&nbsp;</p>
<div align="center">
<p><strong>СЛУЧАЙНЫЕ МЕТОДЫ ДОСТУПА К МОНОКАНАЛУ</strong></p>
</div>
<p>&nbsp;</p>

<p>Различные алгоритмы доступа к моноканалу разрабатывают по причине необходимости разрешения конфликтов между станциями при взаимодействии посредством разделяемой СрПД.</p>

<p>В первую очередь, алгоритмы затрагивают передатчики, то есть активные компоненты системы. Проблема заключается в «столкновениях» конкурирующих передатчиков. Пассивные по своей природе приемники априори конфликтовать не могут. Хотя количество приемников всегда ограничено, так как передатчики имеют конечную нагрузочную способность.</p>

<p>Если находящиеся в равных условиях два либо более передатчиков одновременно выдают сигналы в СрПД (например, устанавливают соответствующие уровни напряжения), то возникает противоречие. Таковое единовременно неразрешимое противоречие принято называть <em>коллизией</em> (collision).</p>

<p>Коллизия может быть как логической (информационный конфликт) так и физической (несовместимые физические процессы). Обычно коллизия возникает при попытках установить противоположные логические уровни. Кроме всего прочего, физическая коллизия чревата выходом из строя передатчиков, даже при попытках установить одинаковые логические уровни, так как многие среды не допускают наличие более чем одного активного усилителя сигнала без применения специальных схемотехнических решений. Классическим способом защиты оборудования от коллизий является так называемая гальваническая развязка (трансформаторная либо оптронная). При попытках установить разные уровни, как правило, наблюдают эффекты «зануления» и «заединичивания» -- в зависимости от особенностей элементной базы.</p>

<p>Ситуация с коллизией может затрагивать только станции, подключенные к одной СрПД, то есть сегмент компьютерной сети. Сегмент, в котором возможно возникновение коллизий называют <em>доменом коллизий</em> (collision domain).</p>

<p>Понятие коллизии имеет отношение не только к сигналу, а и к пакету.</p>

<p>Чтобы передатчик мог бороться с коллизиями он безусловно должен иметь возможность определять факт их наличия.</p>

<p>Борьба с коллизиями, по определению, актуальна применительно к многоточечным топологиям (если под точками понимать подключения), типичными представителями которых являются шинная топология и эфир. На практике, при переходе от двухточечной топологии к многоточечной цепи передатчика и приемника всегда совмещают.</p>

<div align="center">
<img src="lk06.01.bmp">
<br>
Рисунок -- Цепи передатчика и приемника при двухточечной и многоточечной топологиях
</div>

<p>Получить легко наращиваемую структуру по-другому невозможно.</p>

<p>Ответ на вопрос о том как передатчик определяет наличие коллизии весьма удачно «заложен» в показанную схемотехнику. Можно легко заметить, что любая переданная передатчиком порция данных, например байт, тут же будет принята приемником. Достаточно просто сравнить (аппаратно или программно) байт до передачи с байтом после приема. Несовпадение свидетельствует о том, что была коллизия. Ну а если вдруг даже после коллизии данные совпали, то это «устраивает все стороны».</p>

<p>Физические свойства СрПД не позволяют мгновенно передавать сигналы. Следовательно и возникшая коллизия распространяется по сегменту с конечной скоростью. Под <em>окном коллизий</em> (collision window) понимают временной интервал, в течение которого любая из станций гарантированно обнаруживает коллизию, равный удвоенному времени прохождения сигнала между двумя максимально удаленными станциями. Без учета окна коллизий, влияющего на время постудержания сигнала, невозможно спроектировать работоспособный сегмент.</p>

<p>Существуют два основных подхода к проблеме коллизий:<br>
1.&nbsp;Не допускать коллизии вообще, то есть использовать детерминированные методы доступа к моноканалу.<br>
2.&nbsp;Допускать коллизии и каким-то образом выходить из них, что достижимо только использованием случайных методов доступа к моноканалу.</p>

<p>Во втором случае так же можно выделить два подхода:<br>
1.&nbsp;Не обращать внимание на причины возникновения коллизий, а упор делать на способ выхода из них.<br>
2.&nbsp;Пытаться предотвращать коллизии тем самым максимально снижая их количество, ну а если коллизии все-таки возникают, то «тяжело» выходить из них.</p>

<p>Таким образом, все методы доступа к моноканалу делят на:<br>
1.&nbsp;<em>Случайные</em> (contention-based).<br>
2.&nbsp;<em>Детерминированные</em> (controlled).</p>

<p>Все случайные методы основаны на использовании генератора случайных чисел (поэтому их так и называют), который позволяет делать случайные задержки при доступе к моноканалу, а значит и с определенной степенью вероятности избегать коллизии.</p>

<p>На эффективность случайных методов наиболее существенное влияние оказывают следующие факторы:<br>
--&nbsp;количество взаимодействующих станций;<br>
--&nbsp;инертность среды передачи данных;<br>
--&nbsp;длина кадра;<br>
--&nbsp;частота синхронизации.</p>

<p>С точки зрения изучения случайных методов доступа к моноканалу наиболее наглядным примером является классический алгоритм CSMA/CD (Carrier Sense Multiple Access with Collision Detection) -- множественный доступ с прослушиванием несущей и обнаружением коллизий, описанный в стандарте Ethernet (IEEE 802.3).</p>

<div align="center">
<img src="lk06.02.bmp">
<br>
Рисунок -- Алгоритм CSMA/CD. Передача очередного кадра
</div>

<p>&nbsp;</p>

<div align="center">
<img src="lk06.03.bmp">
<br>
Рисунок -- Алгоритм CSMA/CD. Прием очередного кадра
</div>

<p>Задержку перед началом очередной попытки передачи после коллизии (backoff) измеряют в так называемых слот-таймах, количество которых является случайным целым числом <em>r</em>:</p>

<p>0 &le; <em>r</em> &le; 2<em><sup>k</sup></em> ,</p>

<p>где</p>

<p><em>k</em> = min (<em>n</em>, 10) ,</p>

<p>где <em>n</em> -- номер попытки.</p>

<p>После превышения счетчиком попыток некоторого порогового значения дальнейшие попытки считаются бесперспективными. Значение <em>k</em> не может быть больше 10.</p>

<p>Качество диспетчеризации при обработке коллизий по большому счету зависит от одного базового параметра. <em>Cлот-тайм</em> (slot time) является минимальной неделимой единицей времени при диспетчеризации. Слот-тайм подбирают с учетом многих других параметров. По крайней мере, он должен быть больше суммы удвоенного времени прохождения сигнала по сегменту и времени передачи jam-сигнала.</p>

<p>В стандарт заложен механизм ускорения распределенного обнаружения коллизий, заключающийся в их «усилении». Каждая обнаружившая коллизию станция передает специальный <em>jam-сигнал</em> некоторой длительности (значение стандартом не регламентировано). Jam-сигнал выполняет две важные функции. Во-первых, является признаком возникновения коллизии, что позволяет другим станциям сразу «увидеть» коллизию (столкнувшиеся передатчики, выставившие jam-сигнал, и так знают о коллизии). Во-вторых, позволяет синхронизировать начала отсчетов случайных задержек.</p>

<div align="center">
<img src="lk06.04.bmp">
<br>
Рисунок -- Формат кадра Ethernet
</div>

<p>Поля:<br>
1.&nbsp;Preamble -- преамбула.<br>
2.&nbsp;SFD (Start Frame Delimiter) -- разграничитель начала кадра.<br>
3.&nbsp;DA (Destination Address) -- адрес назначения.<br>
4.&nbsp;SA (Source Address) -- адрес источника.<br>
5.&nbsp;Length/Type -- длина либо тип.<br>
6.&nbsp;Data -- данные.<br>
7.&nbsp;Pad -- наполнитель.<br>
8.&nbsp;FCS (Frame Check Sequence) -- контрольная сумма.<br>
9.&nbsp;Extension -- расширитель.</p>

<p>Предусмотрены полудуплексный и полнодуплексный режимы, «поведение» в которых несколько различается.</p>

<p>В качестве преамбулы выступают семь байтов со значением 10101010b, а в качестве SFD -- байт со значением 10101011b.</p>

<p>При сборке кадра учитываются ограничения на его длину. Ограничивается не только максимальная длина, а и минимальная. При недостаче в поле данных вслед за ним в кадр вставляются дополнительные октеты-наполнители (значения стандартом не регламентированы). Параметр MTU (Maximum Transmission Unit) определяет максимальный размер вкладываемых данных. Применительно к Ethernet, если значение поля Length/Type больше либо равно 1536 (600h), то указывает тип инкапсулируемых данных. При необходимости, октеты-расширители дополняет кадр до тайм-слота (только в полудуплексном режиме).</p>

<p>Ethernet-заголовок имеет фиксированную длину. Но, поскольку многие базирующиеся на Ethernet технологии (например, виланы) имеют собственные подзаголовки, заголовок, а следовательно и весь кадр, может увеличиться, правда незначительно и не затрагивая MTU (такие кадры иногда называют baby giant). Некоторые технологии предусматривают значительное увеличение кадра уже за счет увеличения MTU. Например, параметр MTU технологии FCoE (Fibre Channel over Ethernet) равен 2500 байтам (такие кадры иногда называют mini jumbo). Наконец, многие производители оборудования Ethernet предусмотрели нестандартное (но в большинстве случаев совместимое) административное увеличение MTU вплоть до 9000 байтов -- в первую очередь, для оптимизации пересылки больших объемов данных. Такие Ethernet-кадры называют <em>гигантскими</em> (jumbo).</p>

<p>В качестве контрольного кода используется код CRC.</p>

<p>При функционировании с пропускной способностью выше 100&nbsp;Mbit/s (только в полудуплексном режиме) реализация может опционально передавать серию кадров ослабив контроль среды. Такой режим работы называется <em>пакетным режимом</em> (burst mode). Сразу после успешной передачи первого кадра начинается безусловная передача последующих кадров -- это возможно, поскольку передатчики других станций по-прежнему будут находиться в состоянии ожидания. Интервалы между кадрами (interframe gaps), без которых принимающая станция вообще не сможет различать кадры, укорочены до минимума с помощью октетов-расширителей. Количество кадров в пакете ограничено. Считается, что в правильно сконфигурированном сегменте при передаче второго и последующих кадров пакета коллизии возникать не должны. Однако, если такая коллизия возникает, то она обрабатывается особо (выход из алгоритма с ошибкой) -- это так называемая поздняя коллизия (late collision).</p>

<p>Еще одним примером случайных методов доступа к моноканалу является гораздо более сложный алгоритм CSMA/CA (Carrier Sense Multiple Access with Collision Avoidance) -- множественный доступ с прослушиванием несущей и избеганием коллизий, описанный в стандарте Wi-Fi (IEEE 802.11).</p>

<p>Для понимания алгоритма необходимо ввести термины из стандарта.</p>

<p>Применительно к Wi-Fi, MAC-подуровень канального уровня поделен еще на два слоя. На нижнем слое расположен только один блок под названием DCF (Distributed Coordination Function) -- функционал распределенного координируемого взаимодействия. DCF и составляет ядро алгоритма CSMA/CA. Все станции сегмента должны поддерживать DCF. Над DCF расположены:<br>
1.&nbsp;PCF (Point Coordination Function) -- функционал координируемого взаимодействия с использованием станции-координатора.<br>
2.&nbsp;HCF (Hybrid Coordination Function) -- функционал гибридного координируемого взаимодействия.<br>
3.&nbsp;MCF (Mesh Coordination Function) -- функционал сеточного координируемого взаимодействия.</p>

<p>Из них формируют следующие опциональные блоки:<br>
1.&nbsp;PCF.<br>
2.&nbsp;HCCA (HCF Controlled Access).<br>
3.&nbsp;EDCA (HCF/MCF Contention Access).<br>
4.&nbsp;MCCA (MCF Controlled Access).<br>
Кроме DCF, наибольший интерес представляет PCF. Остальные блоки предназначены для поддержки QoS.</p>

<p>В настоящее время реализации Wi-Fi на физическом уровне (беспроводные) очень разнообразны -- используются до десяти различных способов модуляции. Более того, для Wi-Fi характерно создание большого числа параллельных каналов.</p>

<p>Стандартом предусмотрены целых шесть вариантов отслеживаемых межкадровых интервалов -- IFSes (InterFrame Spaces):<br>
1.&nbsp;RIFS (Reduced IFS) -- сокращенный.<br>
2.&nbsp;SIFS (Short IFS) -- короткий.<br>
3.&nbsp;PIFS (PCF IFS) -- для PCF.<br>
4.&nbsp;DIFS (DCF IFS) -- для DCF.<br>
5.&nbsp;AIFS (Arbitration IFS) -- для QoS-арбитража.<br>
6.&nbsp;EIFS (Extended IFS) -- расширенный.</p>

<p>Отслеживание различных IFSes в различных ситуациях влияет на способность станции «видеть щели» между кадрами, а значит и на способность «вклиниваться» в пересылку.</p>

<p>IFSes рассчитывают на основании комплекса параметров.</p>

<p>Кроме интервала DIFS, используемого функционалом DCF, наиболее интересны SIFS и PIFS.</p>

<p>Случайную задержку измеряют в слот-таймах, как и в Ethernet, но алгоритм другой. Количество слот-таймов является случайным целым числом <em>Random</em>:</p>

<p>0 &le; <em>Random</em> &le; <em>CW</em> ,</p>

<p>где <em>CW</em> (contention window) -- так называемое окно состязаний:</p>

<p><em>CW</em><sub>min</sub> &le; <em>CW</em> &le; <em>CW</em><sub>max</sub> ,</p>

<p>и берется из ряда: 7, 15, 31 ... (два в некоторой степени минус один). Крайние значения зависят от способа модуляции (типичное значение <em>CW</em><sub>min</sub> -- 15, типичное значение <em>CW</em><sub>max</sub> -- 1023).</p>

<p>Предусмотрены два счетчика попыток: SRC (Short Retry Count) и LRC (Long Retry Count). Количество попыток ограничено. Выбор значения зависит от физического уровня.</p>

<div align="center">
<img src="lk06.05.bmp">
<br>
Рисунок -- Очень упрощенный алгоритм CSMA/CA (Wi-Fi). Передача очередного кадра
</div>

<p>&nbsp;</p>

<div align="center">
<img src="lk06.06.bmp">
<br>
Рисунок -- Очень упрощенный алгоритм CSMA/CA (Wi-Fi). Прием очередного кадра
</div>

<p>Для беспроводных каналов свойственны две проблемы, которые получили следующие названия:<br>
1.&nbsp;Hidden node problem -- проблема скрытой станции.<br>
2.&nbsp;Exposed node problem -- проблема доступной станции.<br>
Предполагается, что все станции взаимодействуют в рамках одного канала.</p>

<p>Проблему скрытой станции можно сформулировать так: станция C может ошибочно начать передачу станции B, так как не может «услышать» что станция A уже передает станции B (станция A «скрыта» от станции C).</p>

<div align="center">
<img src="lk06.07.jpg">
<br>
Рисунок -- Проблема скрытой станции
</div>

<p>Проблему доступной станции можно сформулировать так: станция C, зная о взаимодействии станций A и B, не может передать станции D во время пассивности станции B, а могла бы, поскольку считает канал занятым ошибочно (станция C «доступна» для станции D).</p>

<div align="center">
<img src="lk06.08.jpg">
<br>
Рисунок -- Проблема доступной станции
</div>

<p>(Эти проблемы возникнут и в проводных каналах, если не учесть окно коллизий.)</p>

<p>Частично решить проблемы помогает опциональное расширение RTS/CTS.</p>

<div align="center">
<img src="lk06.09.bmp">
<br>
Рисунок -- Алгоритм CSMA/CA (Wi-Fi). Расширение RTS/CTS на стороне передатчика и приемника соответственно
</div>

<p>Кадры, поступившие на канальный уровень для дальнейшей передачи, называют MSDUs (MAC Service Data Units). Они могут быть длиной до 2304 байтов. MSDUs разбиваются на меньшие фрагменты, называемые MPDUs (MAC Protocol Data Units), которые передаются в пакетном режиме. Длина фрагментов так же ограничена (например, 4095 байтов).</p>

<p>Уменьшение длины фрагментов приводит к уменьшению вероятности коллизии при передаче отдельно взятого фрагмента, но и к увеличению количества фрагментов.</p>

<div align="center">
<img src="lk06.10.bmp">
<br>
Рисунок -- Алгоритм CSMA/CA (Wi-Fi). Фрагментация
</div>

<p>Еще одним механизмом Wi-Fi для предотвращения коллизий является резервирование канала. Все станции в сегменте обязаны иметь таймеры, называемые NAVs (Network Allocation Vectors). Каждый раз при резервировании значение таймера обновляется согласно временно'му интервалу резервирования и затем уменьшается. Станция не имеет права начать передачу до тех пор, пока значение не достигнет нуля (плюс DIFS). Обращение к таймеру при необходимости передать кадр, в терминологии Wi-Fi, называют виртуальным прослушиванием несущей (происходит параллельно с физическим прослушиванием).</p>

<p>Несмотря на все описанные меры, вероятность коллизий все-равно не равна нулю.</p>

<p>В связи с особенностями беспроводных каналов, в них передатчикам значительно сложнее самостоятельно обнаруживать коллизии. Поэтому эту функцию с них снимают и возлагают на приемники. Вместо обнаружения коллизии, передатчик ждет положительное подтверждение ACK от приемника. Коллизия, как и любая другая проблема с кадром, приведет к отсутствию подтверждения и, далее, к повторной передаче.</p>

<p>Формат кадра Wi-Fi так же сло'жен -- в сравнении с форматом кадра Ethernet. При этом наличие и названия последующих полей зависят от значения предыдущих.</p>

<div align="center">
<img src="lk06.11.bmp">
<br>
Рисунок -- Обобщенный формат кадра Wi-Fi
</div>

<p>Поля:<br>
1.&nbsp;Frame Control -- контроль кадра.<br>
2.&nbsp;Duration/ID -- длительность-идентификатор (0 -- 32767&nbsp;us при резервировании канала, трактовка зависит например от наличия QoS).<br>
3.&nbsp;Address 1 -- адрес 1.<br>
4.&nbsp;Address 2 -- адрес 2.<br>
5.&nbsp;Address 3 -- адрес 3.<br>
6.&nbsp;Sequence Control -- контроль последовательности.<br>
7.&nbsp;Address 4 -- адрес 4.<br>
8.&nbsp;QoS Control -- контроль QoS.<br>
9.&nbsp;HT Control (High Throughput) -- контроль интенсивной пересылки (при QoS).<br>
10.&nbsp;Frame Body -- содержимое кадра (данные).<br>
11.&nbsp;FCS (Frame Control Sequence) -- контрольная сумма.</p>

<p>Поля контроля кадра:<br>
1.&nbsp;Protocol Version -- версия протокола (до сих пор равна нулю).<br>
2.&nbsp;Type -- тип: 00 -- Management -- управление, 01 -- Control -- контроль 10 -- Data -- данные, 11 -- Reserved -- зарезервировано.<br>
3.&nbsp;Subtype -- подтип (в настоящее время определено около сорока подтипов).<br>
4.&nbsp;To DS -- флаг направления в распределительную систему (проводную систему, связывающую беспроводные сегменты).<br>
5.&nbsp;From DS -- флаг направления из распределительной системы.<br>
6.&nbsp;More Fragments -- флаг наличия фрагментации.<br>
7.&nbsp;Retry -- флаг повторной попытки передачи.<br>
8.&nbsp;Power Management -- флаг режима энергосбережения.<br>
9.&nbsp;More Data -- флаг наличия дополнительных данных (например, буферизированных данных для находящейся в режиме энергосбережения станции).<br>
10.&nbsp;Protected Frame -- флаг защищенности кадра (шифрования).<br>
11.&nbsp;Order -- флаг упорядоченности (при QoS).</p>

<p>Таким образом, существуют три типа кадров.</p>

<p>В зависимости от подтипа кадра в адресных полях могут комбинироваться до четырех из пяти возможных адресов: BSSID (Basic Service Set Identifier) -- идентификатор так называемой базовой зоны обслуживания (то есть беспроводного сегмента), SA (Source Address) -- адрес источника, DA (Destination Address) -- адрес назначения, TA (Transmitting station Address) -- адрес станции-передатчика (непосредственного), RA (Receiving station Address) -- адрес станции-приемника (непосредственного).</p>

<p>При PCF, «привязка» оконечной станции к станции-координатору (так называемой точке доступа) протекает в три фазы:<br>
1.&nbsp;Discovery -- обнаружение.<br>
2.&nbsp;Authentication -- аутентификация.<br>
3.&nbsp;Association -- ассоциирование.</p>

<p>Обнаружение может быть активным и пассивным. Оконечная станция в поисках станции-координатора может сканировать эфир пассивно, а может активно генерировать кадры-«пробы» (probe requests). Со своей стороны, станция-координатор может отвечать на кадры-«пробы» (probe responses) пассивно, а может активно периодически извещать о себе и своих услугах с помощью кадров-«маяков» (beacons).</p>

<p>В рамках CSMA/CA существуют две группы алгоритмов:<br>
1.&nbsp;Без наличия станции-координатора и с упреждающим jam-сигналом.<br>
2.&nbsp;С наличием станции-координатора.</p>

<p>Упреждающий jam-сигнал не только информирует о намерении передать кадр, а и является признаком коллизии. Если в процессе передачи своего кадра станция распознает jam-сигнал от другой станции, то возникла коллизия.</p>

<p>Кроме Ethernet и Wi-Fi, в список существующих реализаций случайных методов следует включить технологию Aloha с одноименным алгоритмом. Эта технология была разработана в университете Гавайских островов и была одной из самых ранних технологий КС. В виде стандарта так и не была утверждена. Нашла лишь ограниченное применение в беспроводных каналах для подключения мобильных телефонов первого поколения. Уже давно устарела. Скорость: меньше 1&nbsp;Mbit/s. Логическая топология: двунаправленное кольцо с разделенными цепями передатчиков и приемников. Физическая топология: звезда. Требовалось дополнительное сетевое оборудование (концентраторы). Алгоритм представлял собой сильно упрощенный вариант алгоритма Ethernet. Позже был немного усовершенствован и получил название Slotted Aloha.</p>

</div>

</BODY>
</HTML>
